from numpy.core.numeric import NaN
from pandas.core.frame import DataFrame
from connect import get, copy_from_file
import pandas as pd
from matplotlib import pyplot as plt
from datetime import timedelta, date
import random as rd


cols = '*'
tbl = 'all_dw_2015_2016'
tb2 = 'labeled_all'
modifier = None
where = None
dw = get(tbl, cols, where, modifier, 'CyberEvents')
cve_set = get(tb2, cols, where, modifier)


testvals = cve_set['cve_id'].tolist()
newdata = []
newdata2 = []
for i in range(len(testvals)):
    print(f'{i+1} out of {len(testvals)}')

    temp = []
    cve = testvals[i].lower()
    temp = dw[dw['vulnerabilityid'].str.contains(cve)]['uid'].tolist()
    
    temp2 = dw[dw['vulnerabilityid'].str.contains(cve, na=False)]['postcontent'].tolist()

    # logic to remove duplicates
    temp = list(set(temp))
    temp2 = list(set(temp2))
    newdata.append(len(temp))
    newdata2.append(len(temp2))

cve_set['dw_users'] = newdata
cve_set['dw_post'] = newdata2

copy_from_file(cve_set, 'labeled_all_dw')

print(cve_set)